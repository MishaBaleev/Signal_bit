{"ast":null,"code":"/**\n * Copyright 2013 vtt.js Contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n/* vim: set shiftwidth=2 tabstop=2 autoindent cindent expandtab: */\nvar document = require('global/document');\nvar _objCreate = Object.create || function () {\n  function F() {}\n  return function (o) {\n    if (arguments.length !== 1) {\n      throw new Error('Object.create shim only accepts one parameter.');\n    }\n    F.prototype = o;\n    return new F();\n  };\n}();\n\n// Creates a new ParserError object from an errorData object. The errorData\n// object should have default code and message properties. The default message\n// property can be overriden by passing in a message parameter.\n// See ParsingError.Errors below for acceptable errors.\nfunction ParsingError(errorData, message) {\n  this.name = \"ParsingError\";\n  this.code = errorData.code;\n  this.message = message || errorData.message;\n}\nParsingError.prototype = _objCreate(Error.prototype);\nParsingError.prototype.constructor = ParsingError;\n\n// ParsingError metadata for acceptable ParsingErrors.\nParsingError.Errors = {\n  BadSignature: {\n    code: 0,\n    message: \"Malformed WebVTT signature.\"\n  },\n  BadTimeStamp: {\n    code: 1,\n    message: \"Malformed time stamp.\"\n  }\n};\n\n// Try to parse input as a time stamp.\nfunction parseTimeStamp(input) {\n  function computeSeconds(h, m, s, f) {\n    return (h | 0) * 3600 + (m | 0) * 60 + (s | 0) + (f | 0) / 1000;\n  }\n  var m = input.match(/^(\\d+):(\\d{1,2})(:\\d{1,2})?\\.(\\d{3})/);\n  if (!m) {\n    return null;\n  }\n  if (m[3]) {\n    // Timestamp takes the form of [hours]:[minutes]:[seconds].[milliseconds]\n    return computeSeconds(m[1], m[2], m[3].replace(\":\", \"\"), m[4]);\n  } else if (m[1] > 59) {\n    // Timestamp takes the form of [hours]:[minutes].[milliseconds]\n    // First position is hours as it's over 59.\n    return computeSeconds(m[1], m[2], 0, m[4]);\n  } else {\n    // Timestamp takes the form of [minutes]:[seconds].[milliseconds]\n    return computeSeconds(0, m[1], m[2], m[4]);\n  }\n}\n\n// A settings object holds key/value pairs and will ignore anything but the first\n// assignment to a specific key.\nfunction Settings() {\n  this.values = _objCreate(null);\n}\nSettings.prototype = {\n  // Only accept the first assignment to any key.\n  set: function (k, v) {\n    if (!this.get(k) && v !== \"\") {\n      this.values[k] = v;\n    }\n  },\n  // Return the value for a key, or a default value.\n  // If 'defaultKey' is passed then 'dflt' is assumed to be an object with\n  // a number of possible default values as properties where 'defaultKey' is\n  // the key of the property that will be chosen; otherwise it's assumed to be\n  // a single value.\n  get: function (k, dflt, defaultKey) {\n    if (defaultKey) {\n      return this.has(k) ? this.values[k] : dflt[defaultKey];\n    }\n    return this.has(k) ? this.values[k] : dflt;\n  },\n  // Check whether we have a value for a key.\n  has: function (k) {\n    return k in this.values;\n  },\n  // Accept a setting if its one of the given alternatives.\n  alt: function (k, v, a) {\n    for (var n = 0; n < a.length; ++n) {\n      if (v === a[n]) {\n        this.set(k, v);\n        break;\n      }\n    }\n  },\n  // Accept a setting if its a valid (signed) integer.\n  integer: function (k, v) {\n    if (/^-?\\d+$/.test(v)) {\n      // integer\n      this.set(k, parseInt(v, 10));\n    }\n  },\n  // Accept a setting if its a valid percentage.\n  percent: function (k, v) {\n    var m;\n    if (m = v.match(/^([\\d]{1,3})(\\.[\\d]*)?%$/)) {\n      v = parseFloat(v);\n      if (v >= 0 && v <= 100) {\n        this.set(k, v);\n        return true;\n      }\n    }\n    return false;\n  }\n};\n\n// Helper function to parse input into groups separated by 'groupDelim', and\n// interprete each group as a key/value pair separated by 'keyValueDelim'.\nfunction parseOptions(input, callback, keyValueDelim, groupDelim) {\n  var groups = groupDelim ? input.split(groupDelim) : [input];\n  for (var i in groups) {\n    if (typeof groups[i] !== \"string\") {\n      continue;\n    }\n    var kv = groups[i].split(keyValueDelim);\n    if (kv.length !== 2) {\n      continue;\n    }\n    var k = kv[0].trim();\n    var v = kv[1].trim();\n    callback(k, v);\n  }\n}\nfunction parseCue(input, cue, regionList) {\n  // Remember the original input if we need to throw an error.\n  var oInput = input;\n  // 4.1 WebVTT timestamp\n  function consumeTimeStamp() {\n    var ts = parseTimeStamp(input);\n    if (ts === null) {\n      throw new ParsingError(ParsingError.Errors.BadTimeStamp, \"Malformed timestamp: \" + oInput);\n    }\n    // Remove time stamp from input.\n    input = input.replace(/^[^\\sa-zA-Z-]+/, \"\");\n    return ts;\n  }\n\n  // 4.4.2 WebVTT cue settings\n  function consumeCueSettings(input, cue) {\n    var settings = new Settings();\n    parseOptions(input, function (k, v) {\n      switch (k) {\n        case \"region\":\n          // Find the last region we parsed with the same region id.\n          for (var i = regionList.length - 1; i >= 0; i--) {\n            if (regionList[i].id === v) {\n              settings.set(k, regionList[i].region);\n              break;\n            }\n          }\n          break;\n        case \"vertical\":\n          settings.alt(k, v, [\"rl\", \"lr\"]);\n          break;\n        case \"line\":\n          var vals = v.split(\",\"),\n            vals0 = vals[0];\n          settings.integer(k, vals0);\n          settings.percent(k, vals0) ? settings.set(\"snapToLines\", false) : null;\n          settings.alt(k, vals0, [\"auto\"]);\n          if (vals.length === 2) {\n            settings.alt(\"lineAlign\", vals[1], [\"start\", \"center\", \"end\"]);\n          }\n          break;\n        case \"position\":\n          vals = v.split(\",\");\n          settings.percent(k, vals[0]);\n          if (vals.length === 2) {\n            settings.alt(\"positionAlign\", vals[1], [\"start\", \"center\", \"end\"]);\n          }\n          break;\n        case \"size\":\n          settings.percent(k, v);\n          break;\n        case \"align\":\n          settings.alt(k, v, [\"start\", \"center\", \"end\", \"left\", \"right\"]);\n          break;\n      }\n    }, /:/, /\\s/);\n\n    // Apply default values for any missing fields.\n    cue.region = settings.get(\"region\", null);\n    cue.vertical = settings.get(\"vertical\", \"\");\n    try {\n      cue.line = settings.get(\"line\", \"auto\");\n    } catch (e) {}\n    cue.lineAlign = settings.get(\"lineAlign\", \"start\");\n    cue.snapToLines = settings.get(\"snapToLines\", true);\n    cue.size = settings.get(\"size\", 100);\n    // Safari still uses the old middle value and won't accept center\n    try {\n      cue.align = settings.get(\"align\", \"center\");\n    } catch (e) {\n      cue.align = settings.get(\"align\", \"middle\");\n    }\n    try {\n      cue.position = settings.get(\"position\", \"auto\");\n    } catch (e) {\n      cue.position = settings.get(\"position\", {\n        start: 0,\n        left: 0,\n        center: 50,\n        middle: 50,\n        end: 100,\n        right: 100\n      }, cue.align);\n    }\n    cue.positionAlign = settings.get(\"positionAlign\", {\n      start: \"start\",\n      left: \"start\",\n      center: \"center\",\n      middle: \"center\",\n      end: \"end\",\n      right: \"end\"\n    }, cue.align);\n  }\n  function skipWhitespace() {\n    input = input.replace(/^\\s+/, \"\");\n  }\n\n  // 4.1 WebVTT cue timings.\n  skipWhitespace();\n  cue.startTime = consumeTimeStamp(); // (1) collect cue start time\n  skipWhitespace();\n  if (input.substr(0, 3) !== \"-->\") {\n    // (3) next characters must match \"-->\"\n    throw new ParsingError(ParsingError.Errors.BadTimeStamp, \"Malformed time stamp (time stamps must be separated by '-->'): \" + oInput);\n  }\n  input = input.substr(3);\n  skipWhitespace();\n  cue.endTime = consumeTimeStamp(); // (5) collect cue end time\n\n  // 4.1 WebVTT cue settings list.\n  skipWhitespace();\n  consumeCueSettings(input, cue);\n}\n\n// When evaluating this file as part of a Webpack bundle for server\n// side rendering, `document` is an empty object.\nvar TEXTAREA_ELEMENT = document.createElement && document.createElement(\"textarea\");\nvar TAG_NAME = {\n  c: \"span\",\n  i: \"i\",\n  b: \"b\",\n  u: \"u\",\n  ruby: \"ruby\",\n  rt: \"rt\",\n  v: \"span\",\n  lang: \"span\"\n};\n\n// 5.1 default text color\n// 5.2 default text background color is equivalent to text color with bg_ prefix\nvar DEFAULT_COLOR_CLASS = {\n  white: 'rgba(255,255,255,1)',\n  lime: 'rgba(0,255,0,1)',\n  cyan: 'rgba(0,255,255,1)',\n  red: 'rgba(255,0,0,1)',\n  yellow: 'rgba(255,255,0,1)',\n  magenta: 'rgba(255,0,255,1)',\n  blue: 'rgba(0,0,255,1)',\n  black: 'rgba(0,0,0,1)'\n};\nvar TAG_ANNOTATION = {\n  v: \"title\",\n  lang: \"lang\"\n};\nvar NEEDS_PARENT = {\n  rt: \"ruby\"\n};\n\n// Parse content into a document fragment.\nfunction parseContent(window, input) {\n  function nextToken() {\n    // Check for end-of-string.\n    if (!input) {\n      return null;\n    }\n\n    // Consume 'n' characters from the input.\n    function consume(result) {\n      input = input.substr(result.length);\n      return result;\n    }\n    var m = input.match(/^([^<]*)(<[^>]*>?)?/);\n    // If there is some text before the next tag, return it, otherwise return\n    // the tag.\n    return consume(m[1] ? m[1] : m[2]);\n  }\n  function unescape(s) {\n    TEXTAREA_ELEMENT.innerHTML = s;\n    s = TEXTAREA_ELEMENT.textContent;\n    TEXTAREA_ELEMENT.textContent = \"\";\n    return s;\n  }\n  function shouldAdd(current, element) {\n    return !NEEDS_PARENT[element.localName] || NEEDS_PARENT[element.localName] === current.localName;\n  }\n\n  // Create an element for this tag.\n  function createElement(type, annotation) {\n    var tagName = TAG_NAME[type];\n    if (!tagName) {\n      return null;\n    }\n    var element = window.document.createElement(tagName);\n    var name = TAG_ANNOTATION[type];\n    if (name && annotation) {\n      element[name] = annotation.trim();\n    }\n    return element;\n  }\n  var rootDiv = window.document.createElement(\"div\"),\n    current = rootDiv,\n    t,\n    tagStack = [];\n  while ((t = nextToken()) !== null) {\n    if (t[0] === '<') {\n      if (t[1] === \"/\") {\n        // If the closing tag matches, move back up to the parent node.\n        if (tagStack.length && tagStack[tagStack.length - 1] === t.substr(2).replace(\">\", \"\")) {\n          tagStack.pop();\n          current = current.parentNode;\n        }\n        // Otherwise just ignore the end tag.\n        continue;\n      }\n      var ts = parseTimeStamp(t.substr(1, t.length - 2));\n      var node;\n      if (ts) {\n        // Timestamps are lead nodes as well.\n        node = window.document.createProcessingInstruction(\"timestamp\", ts);\n        current.appendChild(node);\n        continue;\n      }\n      var m = t.match(/^<([^.\\s/0-9>]+)(\\.[^\\s\\\\>]+)?([^>\\\\]+)?(\\\\?)>?$/);\n      // If we can't parse the tag, skip to the next tag.\n      if (!m) {\n        continue;\n      }\n      // Try to construct an element, and ignore the tag if we couldn't.\n      node = createElement(m[1], m[3]);\n      if (!node) {\n        continue;\n      }\n      // Determine if the tag should be added based on the context of where it\n      // is placed in the cuetext.\n      if (!shouldAdd(current, node)) {\n        continue;\n      }\n      // Set the class list (as a list of classes, separated by space).\n      if (m[2]) {\n        var classes = m[2].split('.');\n        classes.forEach(function (cl) {\n          var bgColor = /^bg_/.test(cl);\n          // slice out `bg_` if it's a background color\n          var colorName = bgColor ? cl.slice(3) : cl;\n          if (DEFAULT_COLOR_CLASS.hasOwnProperty(colorName)) {\n            var propName = bgColor ? 'background-color' : 'color';\n            var propValue = DEFAULT_COLOR_CLASS[colorName];\n            node.style[propName] = propValue;\n          }\n        });\n        node.className = classes.join(' ');\n      }\n      // Append the node to the current node, and enter the scope of the new\n      // node.\n      tagStack.push(m[1]);\n      current.appendChild(node);\n      current = node;\n      continue;\n    }\n\n    // Text nodes are leaf nodes.\n    current.appendChild(window.document.createTextNode(unescape(t)));\n  }\n  return rootDiv;\n}\n\n// This is a list of all the Unicode characters that have a strong\n// right-to-left category. What this means is that these characters are\n// written right-to-left for sure. It was generated by pulling all the strong\n// right-to-left characters out of the Unicode data table. That table can\n// found at: http://www.unicode.org/Public/UNIDATA/UnicodeData.txt\nvar strongRTLRanges = [[0x5be, 0x5be], [0x5c0, 0x5c0], [0x5c3, 0x5c3], [0x5c6, 0x5c6], [0x5d0, 0x5ea], [0x5f0, 0x5f4], [0x608, 0x608], [0x60b, 0x60b], [0x60d, 0x60d], [0x61b, 0x61b], [0x61e, 0x64a], [0x66d, 0x66f], [0x671, 0x6d5], [0x6e5, 0x6e6], [0x6ee, 0x6ef], [0x6fa, 0x70d], [0x70f, 0x710], [0x712, 0x72f], [0x74d, 0x7a5], [0x7b1, 0x7b1], [0x7c0, 0x7ea], [0x7f4, 0x7f5], [0x7fa, 0x7fa], [0x800, 0x815], [0x81a, 0x81a], [0x824, 0x824], [0x828, 0x828], [0x830, 0x83e], [0x840, 0x858], [0x85e, 0x85e], [0x8a0, 0x8a0], [0x8a2, 0x8ac], [0x200f, 0x200f], [0xfb1d, 0xfb1d], [0xfb1f, 0xfb28], [0xfb2a, 0xfb36], [0xfb38, 0xfb3c], [0xfb3e, 0xfb3e], [0xfb40, 0xfb41], [0xfb43, 0xfb44], [0xfb46, 0xfbc1], [0xfbd3, 0xfd3d], [0xfd50, 0xfd8f], [0xfd92, 0xfdc7], [0xfdf0, 0xfdfc], [0xfe70, 0xfe74], [0xfe76, 0xfefc], [0x10800, 0x10805], [0x10808, 0x10808], [0x1080a, 0x10835], [0x10837, 0x10838], [0x1083c, 0x1083c], [0x1083f, 0x10855], [0x10857, 0x1085f], [0x10900, 0x1091b], [0x10920, 0x10939], [0x1093f, 0x1093f], [0x10980, 0x109b7], [0x109be, 0x109bf], [0x10a00, 0x10a00], [0x10a10, 0x10a13], [0x10a15, 0x10a17], [0x10a19, 0x10a33], [0x10a40, 0x10a47], [0x10a50, 0x10a58], [0x10a60, 0x10a7f], [0x10b00, 0x10b35], [0x10b40, 0x10b55], [0x10b58, 0x10b72], [0x10b78, 0x10b7f], [0x10c00, 0x10c48], [0x1ee00, 0x1ee03], [0x1ee05, 0x1ee1f], [0x1ee21, 0x1ee22], [0x1ee24, 0x1ee24], [0x1ee27, 0x1ee27], [0x1ee29, 0x1ee32], [0x1ee34, 0x1ee37], [0x1ee39, 0x1ee39], [0x1ee3b, 0x1ee3b], [0x1ee42, 0x1ee42], [0x1ee47, 0x1ee47], [0x1ee49, 0x1ee49], [0x1ee4b, 0x1ee4b], [0x1ee4d, 0x1ee4f], [0x1ee51, 0x1ee52], [0x1ee54, 0x1ee54], [0x1ee57, 0x1ee57], [0x1ee59, 0x1ee59], [0x1ee5b, 0x1ee5b], [0x1ee5d, 0x1ee5d], [0x1ee5f, 0x1ee5f], [0x1ee61, 0x1ee62], [0x1ee64, 0x1ee64], [0x1ee67, 0x1ee6a], [0x1ee6c, 0x1ee72], [0x1ee74, 0x1ee77], [0x1ee79, 0x1ee7c], [0x1ee7e, 0x1ee7e], [0x1ee80, 0x1ee89], [0x1ee8b, 0x1ee9b], [0x1eea1, 0x1eea3], [0x1eea5, 0x1eea9], [0x1eeab, 0x1eebb], [0x10fffd, 0x10fffd]];\nfunction isStrongRTLChar(charCode) {\n  for (var i = 0; i < strongRTLRanges.length; i++) {\n    var currentRange = strongRTLRanges[i];\n    if (charCode >= currentRange[0] && charCode <= currentRange[1]) {\n      return true;\n    }\n  }\n  return false;\n}\nfunction determineBidi(cueDiv) {\n  var nodeStack = [],\n    text = \"\",\n    charCode;\n  if (!cueDiv || !cueDiv.childNodes) {\n    return \"ltr\";\n  }\n  function pushNodes(nodeStack, node) {\n    for (var i = node.childNodes.length - 1; i >= 0; i--) {\n      nodeStack.push(node.childNodes[i]);\n    }\n  }\n  function nextTextNode(nodeStack) {\n    if (!nodeStack || !nodeStack.length) {\n      return null;\n    }\n    var node = nodeStack.pop(),\n      text = node.textContent || node.innerText;\n    if (text) {\n      // TODO: This should match all unicode type B characters (paragraph\n      // separator characters). See issue #115.\n      var m = text.match(/^.*(\\n|\\r)/);\n      if (m) {\n        nodeStack.length = 0;\n        return m[0];\n      }\n      return text;\n    }\n    if (node.tagName === \"ruby\") {\n      return nextTextNode(nodeStack);\n    }\n    if (node.childNodes) {\n      pushNodes(nodeStack, node);\n      return nextTextNode(nodeStack);\n    }\n  }\n  pushNodes(nodeStack, cueDiv);\n  while (text = nextTextNode(nodeStack)) {\n    for (var i = 0; i < text.length; i++) {\n      charCode = text.charCodeAt(i);\n      if (isStrongRTLChar(charCode)) {\n        return \"rtl\";\n      }\n    }\n  }\n  return \"ltr\";\n}\nfunction computeLinePos(cue) {\n  if (typeof cue.line === \"number\" && (cue.snapToLines || cue.line >= 0 && cue.line <= 100)) {\n    return cue.line;\n  }\n  if (!cue.track || !cue.track.textTrackList || !cue.track.textTrackList.mediaElement) {\n    return -1;\n  }\n  var track = cue.track,\n    trackList = track.textTrackList,\n    count = 0;\n  for (var i = 0; i < trackList.length && trackList[i] !== track; i++) {\n    if (trackList[i].mode === \"showing\") {\n      count++;\n    }\n  }\n  return ++count * -1;\n}\nfunction StyleBox() {}\n\n// Apply styles to a div. If there is no div passed then it defaults to the\n// div on 'this'.\nStyleBox.prototype.applyStyles = function (styles, div) {\n  div = div || this.div;\n  for (var prop in styles) {\n    if (styles.hasOwnProperty(prop)) {\n      div.style[prop] = styles[prop];\n    }\n  }\n};\nStyleBox.prototype.formatStyle = function (val, unit) {\n  return val === 0 ? 0 : val + unit;\n};\n\n// Constructs the computed display state of the cue (a div). Places the div\n// into the overlay which should be a block level element (usually a div).\nfunction CueStyleBox(window, cue, styleOptions) {\n  StyleBox.call(this);\n  this.cue = cue;\n\n  // Parse our cue's text into a DOM tree rooted at 'cueDiv'. This div will\n  // have inline positioning and will function as the cue background box.\n  this.cueDiv = parseContent(window, cue.text);\n  var styles = {\n    color: \"rgba(255, 255, 255, 1)\",\n    backgroundColor: \"rgba(0, 0, 0, 0.8)\",\n    position: \"relative\",\n    left: 0,\n    right: 0,\n    top: 0,\n    bottom: 0,\n    display: \"inline\",\n    writingMode: cue.vertical === \"\" ? \"horizontal-tb\" : cue.vertical === \"lr\" ? \"vertical-lr\" : \"vertical-rl\",\n    unicodeBidi: \"plaintext\"\n  };\n  this.applyStyles(styles, this.cueDiv);\n\n  // Create an absolutely positioned div that will be used to position the cue\n  // div. Note, all WebVTT cue-setting alignments are equivalent to the CSS\n  // mirrors of them except middle instead of center on Safari.\n  this.div = window.document.createElement(\"div\");\n  styles = {\n    direction: determineBidi(this.cueDiv),\n    writingMode: cue.vertical === \"\" ? \"horizontal-tb\" : cue.vertical === \"lr\" ? \"vertical-lr\" : \"vertical-rl\",\n    unicodeBidi: \"plaintext\",\n    textAlign: cue.align === \"middle\" ? \"center\" : cue.align,\n    font: styleOptions.font,\n    whiteSpace: \"pre-line\",\n    position: \"absolute\"\n  };\n  this.applyStyles(styles);\n  this.div.appendChild(this.cueDiv);\n\n  // Calculate the distance from the reference edge of the viewport to the text\n  // position of the cue box. The reference edge will be resolved later when\n  // the box orientation styles are applied.\n  var textPos = 0;\n  switch (cue.positionAlign) {\n    case \"start\":\n    case \"line-left\":\n      textPos = cue.position;\n      break;\n    case \"center\":\n      textPos = cue.position - cue.size / 2;\n      break;\n    case \"end\":\n    case \"line-right\":\n      textPos = cue.position - cue.size;\n      break;\n  }\n\n  // Horizontal box orientation; textPos is the distance from the left edge of the\n  // area to the left edge of the box and cue.size is the distance extending to\n  // the right from there.\n  if (cue.vertical === \"\") {\n    this.applyStyles({\n      left: this.formatStyle(textPos, \"%\"),\n      width: this.formatStyle(cue.size, \"%\")\n    });\n    // Vertical box orientation; textPos is the distance from the top edge of the\n    // area to the top edge of the box and cue.size is the height extending\n    // downwards from there.\n  } else {\n    this.applyStyles({\n      top: this.formatStyle(textPos, \"%\"),\n      height: this.formatStyle(cue.size, \"%\")\n    });\n  }\n  this.move = function (box) {\n    this.applyStyles({\n      top: this.formatStyle(box.top, \"px\"),\n      bottom: this.formatStyle(box.bottom, \"px\"),\n      left: this.formatStyle(box.left, \"px\"),\n      right: this.formatStyle(box.right, \"px\"),\n      height: this.formatStyle(box.height, \"px\"),\n      width: this.formatStyle(box.width, \"px\")\n    });\n  };\n}\nCueStyleBox.prototype = _objCreate(StyleBox.prototype);\nCueStyleBox.prototype.constructor = CueStyleBox;\n\n// Represents the co-ordinates of an Element in a way that we can easily\n// compute things with such as if it overlaps or intersects with another Element.\n// Can initialize it with either a StyleBox or another BoxPosition.\nfunction BoxPosition(obj) {\n  // Either a BoxPosition was passed in and we need to copy it, or a StyleBox\n  // was passed in and we need to copy the results of 'getBoundingClientRect'\n  // as the object returned is readonly. All co-ordinate values are in reference\n  // to the viewport origin (top left).\n  var lh, height, width, top;\n  if (obj.div) {\n    height = obj.div.offsetHeight;\n    width = obj.div.offsetWidth;\n    top = obj.div.offsetTop;\n    var rects = (rects = obj.div.childNodes) && (rects = rects[0]) && rects.getClientRects && rects.getClientRects();\n    obj = obj.div.getBoundingClientRect();\n    // In certain cases the outter div will be slightly larger then the sum of\n    // the inner div's lines. This could be due to bold text, etc, on some platforms.\n    // In this case we should get the average line height and use that. This will\n    // result in the desired behaviour.\n    lh = rects ? Math.max(rects[0] && rects[0].height || 0, obj.height / rects.length) : 0;\n  }\n  this.left = obj.left;\n  this.right = obj.right;\n  this.top = obj.top || top;\n  this.height = obj.height || height;\n  this.bottom = obj.bottom || top + (obj.height || height);\n  this.width = obj.width || width;\n  this.lineHeight = lh !== undefined ? lh : obj.lineHeight;\n}\n\n// Move the box along a particular axis. Optionally pass in an amount to move\n// the box. If no amount is passed then the default is the line height of the\n// box.\nBoxPosition.prototype.move = function (axis, toMove) {\n  toMove = toMove !== undefined ? toMove : this.lineHeight;\n  switch (axis) {\n    case \"+x\":\n      this.left += toMove;\n      this.right += toMove;\n      break;\n    case \"-x\":\n      this.left -= toMove;\n      this.right -= toMove;\n      break;\n    case \"+y\":\n      this.top += toMove;\n      this.bottom += toMove;\n      break;\n    case \"-y\":\n      this.top -= toMove;\n      this.bottom -= toMove;\n      break;\n  }\n};\n\n// Check if this box overlaps another box, b2.\nBoxPosition.prototype.overlaps = function (b2) {\n  return this.left < b2.right && this.right > b2.left && this.top < b2.bottom && this.bottom > b2.top;\n};\n\n// Check if this box overlaps any other boxes in boxes.\nBoxPosition.prototype.overlapsAny = function (boxes) {\n  for (var i = 0; i < boxes.length; i++) {\n    if (this.overlaps(boxes[i])) {\n      return true;\n    }\n  }\n  return false;\n};\n\n// Check if this box is within another box.\nBoxPosition.prototype.within = function (container) {\n  return this.top >= container.top && this.bottom <= container.bottom && this.left >= container.left && this.right <= container.right;\n};\n\n// Check if this box is entirely within the container or it is overlapping\n// on the edge opposite of the axis direction passed. For example, if \"+x\" is\n// passed and the box is overlapping on the left edge of the container, then\n// return true.\nBoxPosition.prototype.overlapsOppositeAxis = function (container, axis) {\n  switch (axis) {\n    case \"+x\":\n      return this.left < container.left;\n    case \"-x\":\n      return this.right > container.right;\n    case \"+y\":\n      return this.top < container.top;\n    case \"-y\":\n      return this.bottom > container.bottom;\n  }\n};\n\n// Find the percentage of the area that this box is overlapping with another\n// box.\nBoxPosition.prototype.intersectPercentage = function (b2) {\n  var x = Math.max(0, Math.min(this.right, b2.right) - Math.max(this.left, b2.left)),\n    y = Math.max(0, Math.min(this.bottom, b2.bottom) - Math.max(this.top, b2.top)),\n    intersectArea = x * y;\n  return intersectArea / (this.height * this.width);\n};\n\n// Convert the positions from this box to CSS compatible positions using\n// the reference container's positions. This has to be done because this\n// box's positions are in reference to the viewport origin, whereas, CSS\n// values are in referecne to their respective edges.\nBoxPosition.prototype.toCSSCompatValues = function (reference) {\n  return {\n    top: this.top - reference.top,\n    bottom: reference.bottom - this.bottom,\n    left: this.left - reference.left,\n    right: reference.right - this.right,\n    height: this.height,\n    width: this.width\n  };\n};\n\n// Get an object that represents the box's position without anything extra.\n// Can pass a StyleBox, HTMLElement, or another BoxPositon.\nBoxPosition.getSimpleBoxPosition = function (obj) {\n  var height = obj.div ? obj.div.offsetHeight : obj.tagName ? obj.offsetHeight : 0;\n  var width = obj.div ? obj.div.offsetWidth : obj.tagName ? obj.offsetWidth : 0;\n  var top = obj.div ? obj.div.offsetTop : obj.tagName ? obj.offsetTop : 0;\n  obj = obj.div ? obj.div.getBoundingClientRect() : obj.tagName ? obj.getBoundingClientRect() : obj;\n  var ret = {\n    left: obj.left,\n    right: obj.right,\n    top: obj.top || top,\n    height: obj.height || height,\n    bottom: obj.bottom || top + (obj.height || height),\n    width: obj.width || width\n  };\n  return ret;\n};\n\n// Move a StyleBox to its specified, or next best, position. The containerBox\n// is the box that contains the StyleBox, such as a div. boxPositions are\n// a list of other boxes that the styleBox can't overlap with.\nfunction moveBoxToLinePosition(window, styleBox, containerBox, boxPositions) {\n  // Find the best position for a cue box, b, on the video. The axis parameter\n  // is a list of axis, the order of which, it will move the box along. For example:\n  // Passing [\"+x\", \"-x\"] will move the box first along the x axis in the positive\n  // direction. If it doesn't find a good position for it there it will then move\n  // it along the x axis in the negative direction.\n  function findBestPosition(b, axis) {\n    var bestPosition,\n      specifiedPosition = new BoxPosition(b),\n      percentage = 1; // Highest possible so the first thing we get is better.\n\n    for (var i = 0; i < axis.length; i++) {\n      while (b.overlapsOppositeAxis(containerBox, axis[i]) || b.within(containerBox) && b.overlapsAny(boxPositions)) {\n        b.move(axis[i]);\n      }\n      // We found a spot where we aren't overlapping anything. This is our\n      // best position.\n      if (b.within(containerBox)) {\n        return b;\n      }\n      var p = b.intersectPercentage(containerBox);\n      // If we're outside the container box less then we were on our last try\n      // then remember this position as the best position.\n      if (percentage > p) {\n        bestPosition = new BoxPosition(b);\n        percentage = p;\n      }\n      // Reset the box position to the specified position.\n      b = new BoxPosition(specifiedPosition);\n    }\n    return bestPosition || specifiedPosition;\n  }\n  var boxPosition = new BoxPosition(styleBox),\n    cue = styleBox.cue,\n    linePos = computeLinePos(cue),\n    axis = [];\n\n  // If we have a line number to align the cue to.\n  if (cue.snapToLines) {\n    var size;\n    switch (cue.vertical) {\n      case \"\":\n        axis = [\"+y\", \"-y\"];\n        size = \"height\";\n        break;\n      case \"rl\":\n        axis = [\"+x\", \"-x\"];\n        size = \"width\";\n        break;\n      case \"lr\":\n        axis = [\"-x\", \"+x\"];\n        size = \"width\";\n        break;\n    }\n    var step = boxPosition.lineHeight,\n      position = step * Math.round(linePos),\n      maxPosition = containerBox[size] + step,\n      initialAxis = axis[0];\n\n    // If the specified intial position is greater then the max position then\n    // clamp the box to the amount of steps it would take for the box to\n    // reach the max position.\n    if (Math.abs(position) > maxPosition) {\n      position = position < 0 ? -1 : 1;\n      position *= Math.ceil(maxPosition / step) * step;\n    }\n\n    // If computed line position returns negative then line numbers are\n    // relative to the bottom of the video instead of the top. Therefore, we\n    // need to increase our initial position by the length or width of the\n    // video, depending on the writing direction, and reverse our axis directions.\n    if (linePos < 0) {\n      position += cue.vertical === \"\" ? containerBox.height : containerBox.width;\n      axis = axis.reverse();\n    }\n\n    // Move the box to the specified position. This may not be its best\n    // position.\n    boxPosition.move(initialAxis, position);\n  } else {\n    // If we have a percentage line value for the cue.\n    var calculatedPercentage = boxPosition.lineHeight / containerBox.height * 100;\n    switch (cue.lineAlign) {\n      case \"center\":\n        linePos -= calculatedPercentage / 2;\n        break;\n      case \"end\":\n        linePos -= calculatedPercentage;\n        break;\n    }\n\n    // Apply initial line position to the cue box.\n    switch (cue.vertical) {\n      case \"\":\n        styleBox.applyStyles({\n          top: styleBox.formatStyle(linePos, \"%\")\n        });\n        break;\n      case \"rl\":\n        styleBox.applyStyles({\n          left: styleBox.formatStyle(linePos, \"%\")\n        });\n        break;\n      case \"lr\":\n        styleBox.applyStyles({\n          right: styleBox.formatStyle(linePos, \"%\")\n        });\n        break;\n    }\n    axis = [\"+y\", \"-x\", \"+x\", \"-y\"];\n\n    // Get the box position again after we've applied the specified positioning\n    // to it.\n    boxPosition = new BoxPosition(styleBox);\n  }\n  var bestPosition = findBestPosition(boxPosition, axis);\n  styleBox.move(bestPosition.toCSSCompatValues(containerBox));\n}\nfunction WebVTT() {\n  // Nothing\n}\n\n// Helper to allow strings to be decoded instead of the default binary utf8 data.\nWebVTT.StringDecoder = function () {\n  return {\n    decode: function (data) {\n      if (!data) {\n        return \"\";\n      }\n      if (typeof data !== \"string\") {\n        throw new Error(\"Error - expected string data.\");\n      }\n      return decodeURIComponent(encodeURIComponent(data));\n    }\n  };\n};\nWebVTT.convertCueToDOMTree = function (window, cuetext) {\n  if (!window || !cuetext) {\n    return null;\n  }\n  return parseContent(window, cuetext);\n};\nvar FONT_SIZE_PERCENT = 0.05;\nvar FONT_STYLE = \"sans-serif\";\nvar CUE_BACKGROUND_PADDING = \"1.5%\";\n\n// Runs the processing model over the cues and regions passed to it.\n// @param overlay A block level element (usually a div) that the computed cues\n//                and regions will be placed into.\nWebVTT.processCues = function (window, cues, overlay) {\n  if (!window || !cues || !overlay) {\n    return null;\n  }\n\n  // Remove all previous children.\n  while (overlay.firstChild) {\n    overlay.removeChild(overlay.firstChild);\n  }\n  var paddedOverlay = window.document.createElement(\"div\");\n  paddedOverlay.style.position = \"absolute\";\n  paddedOverlay.style.left = \"0\";\n  paddedOverlay.style.right = \"0\";\n  paddedOverlay.style.top = \"0\";\n  paddedOverlay.style.bottom = \"0\";\n  paddedOverlay.style.margin = CUE_BACKGROUND_PADDING;\n  overlay.appendChild(paddedOverlay);\n\n  // Determine if we need to compute the display states of the cues. This could\n  // be the case if a cue's state has been changed since the last computation or\n  // if it has not been computed yet.\n  function shouldCompute(cues) {\n    for (var i = 0; i < cues.length; i++) {\n      if (cues[i].hasBeenReset || !cues[i].displayState) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  // We don't need to recompute the cues' display states. Just reuse them.\n  if (!shouldCompute(cues)) {\n    for (var i = 0; i < cues.length; i++) {\n      paddedOverlay.appendChild(cues[i].displayState);\n    }\n    return;\n  }\n  var boxPositions = [],\n    containerBox = BoxPosition.getSimpleBoxPosition(paddedOverlay),\n    fontSize = Math.round(containerBox.height * FONT_SIZE_PERCENT * 100) / 100;\n  var styleOptions = {\n    font: fontSize + \"px \" + FONT_STYLE\n  };\n  (function () {\n    var styleBox, cue;\n    for (var i = 0; i < cues.length; i++) {\n      cue = cues[i];\n\n      // Compute the intial position and styles of the cue div.\n      styleBox = new CueStyleBox(window, cue, styleOptions);\n      paddedOverlay.appendChild(styleBox.div);\n\n      // Move the cue div to it's correct line position.\n      moveBoxToLinePosition(window, styleBox, containerBox, boxPositions);\n\n      // Remember the computed div so that we don't have to recompute it later\n      // if we don't have too.\n      cue.displayState = styleBox.div;\n      boxPositions.push(BoxPosition.getSimpleBoxPosition(styleBox));\n    }\n  })();\n};\nWebVTT.Parser = function (window, vttjs, decoder) {\n  if (!decoder) {\n    decoder = vttjs;\n    vttjs = {};\n  }\n  if (!vttjs) {\n    vttjs = {};\n  }\n  this.window = window;\n  this.vttjs = vttjs;\n  this.state = \"INITIAL\";\n  this.buffer = \"\";\n  this.decoder = decoder || new TextDecoder(\"utf8\");\n  this.regionList = [];\n};\nWebVTT.Parser.prototype = {\n  // If the error is a ParsingError then report it to the consumer if\n  // possible. If it's not a ParsingError then throw it like normal.\n  reportOrThrowError: function (e) {\n    if (e instanceof ParsingError) {\n      this.onparsingerror && this.onparsingerror(e);\n    } else {\n      throw e;\n    }\n  },\n  parse: function (data) {\n    var self = this;\n\n    // If there is no data then we won't decode it, but will just try to parse\n    // whatever is in buffer already. This may occur in circumstances, for\n    // example when flush() is called.\n    if (data) {\n      // Try to decode the data that we received.\n      self.buffer += self.decoder.decode(data, {\n        stream: true\n      });\n    }\n    function collectNextLine() {\n      var buffer = self.buffer;\n      var pos = 0;\n      while (pos < buffer.length && buffer[pos] !== '\\r' && buffer[pos] !== '\\n') {\n        ++pos;\n      }\n      var line = buffer.substr(0, pos);\n      // Advance the buffer early in case we fail below.\n      if (buffer[pos] === '\\r') {\n        ++pos;\n      }\n      if (buffer[pos] === '\\n') {\n        ++pos;\n      }\n      self.buffer = buffer.substr(pos);\n      return line;\n    }\n\n    // 3.4 WebVTT region and WebVTT region settings syntax\n    function parseRegion(input) {\n      var settings = new Settings();\n      parseOptions(input, function (k, v) {\n        switch (k) {\n          case \"id\":\n            settings.set(k, v);\n            break;\n          case \"width\":\n            settings.percent(k, v);\n            break;\n          case \"lines\":\n            settings.integer(k, v);\n            break;\n          case \"regionanchor\":\n          case \"viewportanchor\":\n            var xy = v.split(',');\n            if (xy.length !== 2) {\n              break;\n            }\n            // We have to make sure both x and y parse, so use a temporary\n            // settings object here.\n            var anchor = new Settings();\n            anchor.percent(\"x\", xy[0]);\n            anchor.percent(\"y\", xy[1]);\n            if (!anchor.has(\"x\") || !anchor.has(\"y\")) {\n              break;\n            }\n            settings.set(k + \"X\", anchor.get(\"x\"));\n            settings.set(k + \"Y\", anchor.get(\"y\"));\n            break;\n          case \"scroll\":\n            settings.alt(k, v, [\"up\"]);\n            break;\n        }\n      }, /=/, /\\s/);\n\n      // Create the region, using default values for any values that were not\n      // specified.\n      if (settings.has(\"id\")) {\n        var region = new (self.vttjs.VTTRegion || self.window.VTTRegion)();\n        region.width = settings.get(\"width\", 100);\n        region.lines = settings.get(\"lines\", 3);\n        region.regionAnchorX = settings.get(\"regionanchorX\", 0);\n        region.regionAnchorY = settings.get(\"regionanchorY\", 100);\n        region.viewportAnchorX = settings.get(\"viewportanchorX\", 0);\n        region.viewportAnchorY = settings.get(\"viewportanchorY\", 100);\n        region.scroll = settings.get(\"scroll\", \"\");\n        // Register the region.\n        self.onregion && self.onregion(region);\n        // Remember the VTTRegion for later in case we parse any VTTCues that\n        // reference it.\n        self.regionList.push({\n          id: settings.get(\"id\"),\n          region: region\n        });\n      }\n    }\n\n    // draft-pantos-http-live-streaming-20\n    // https://tools.ietf.org/html/draft-pantos-http-live-streaming-20#section-3.5\n    // 3.5 WebVTT\n    function parseTimestampMap(input) {\n      var settings = new Settings();\n      parseOptions(input, function (k, v) {\n        switch (k) {\n          case \"MPEGT\":\n            settings.integer(k + 'S', v);\n            break;\n          case \"LOCA\":\n            settings.set(k + 'L', parseTimeStamp(v));\n            break;\n        }\n      }, /[^\\d]:/, /,/);\n      self.ontimestampmap && self.ontimestampmap({\n        \"MPEGTS\": settings.get(\"MPEGTS\"),\n        \"LOCAL\": settings.get(\"LOCAL\")\n      });\n    }\n\n    // 3.2 WebVTT metadata header syntax\n    function parseHeader(input) {\n      if (input.match(/X-TIMESTAMP-MAP/)) {\n        // This line contains HLS X-TIMESTAMP-MAP metadata\n        parseOptions(input, function (k, v) {\n          switch (k) {\n            case \"X-TIMESTAMP-MAP\":\n              parseTimestampMap(v);\n              break;\n          }\n        }, /=/);\n      } else {\n        parseOptions(input, function (k, v) {\n          switch (k) {\n            case \"Region\":\n              // 3.3 WebVTT region metadata header syntax\n              parseRegion(v);\n              break;\n          }\n        }, /:/);\n      }\n    }\n\n    // 5.1 WebVTT file parsing.\n    try {\n      var line;\n      if (self.state === \"INITIAL\") {\n        // We can't start parsing until we have the first line.\n        if (!/\\r\\n|\\n/.test(self.buffer)) {\n          return this;\n        }\n        line = collectNextLine();\n        var m = line.match(/^WEBVTT([ \\t].*)?$/);\n        if (!m || !m[0]) {\n          throw new ParsingError(ParsingError.Errors.BadSignature);\n        }\n        self.state = \"HEADER\";\n      }\n      var alreadyCollectedLine = false;\n      while (self.buffer) {\n        // We can't parse a line until we have the full line.\n        if (!/\\r\\n|\\n/.test(self.buffer)) {\n          return this;\n        }\n        if (!alreadyCollectedLine) {\n          line = collectNextLine();\n        } else {\n          alreadyCollectedLine = false;\n        }\n        switch (self.state) {\n          case \"HEADER\":\n            // 13-18 - Allow a header (metadata) under the WEBVTT line.\n            if (/:/.test(line)) {\n              parseHeader(line);\n            } else if (!line) {\n              // An empty line terminates the header and starts the body (cues).\n              self.state = \"ID\";\n            }\n            continue;\n          case \"NOTE\":\n            // Ignore NOTE blocks.\n            if (!line) {\n              self.state = \"ID\";\n            }\n            continue;\n          case \"ID\":\n            // Check for the start of NOTE blocks.\n            if (/^NOTE($|[ \\t])/.test(line)) {\n              self.state = \"NOTE\";\n              break;\n            }\n            // 19-29 - Allow any number of line terminators, then initialize new cue values.\n            if (!line) {\n              continue;\n            }\n            self.cue = new (self.vttjs.VTTCue || self.window.VTTCue)(0, 0, \"\");\n            // Safari still uses the old middle value and won't accept center\n            try {\n              self.cue.align = \"center\";\n            } catch (e) {\n              self.cue.align = \"middle\";\n            }\n            self.state = \"CUE\";\n            // 30-39 - Check if self line contains an optional identifier or timing data.\n            if (line.indexOf(\"-->\") === -1) {\n              self.cue.id = line;\n              continue;\n            }\n          // Process line as start of a cue.\n          /*falls through*/\n          case \"CUE\":\n            // 40 - Collect cue timings and settings.\n            try {\n              parseCue(line, self.cue, self.regionList);\n            } catch (e) {\n              self.reportOrThrowError(e);\n              // In case of an error ignore rest of the cue.\n              self.cue = null;\n              self.state = \"BADCUE\";\n              continue;\n            }\n            self.state = \"CUETEXT\";\n            continue;\n          case \"CUETEXT\":\n            var hasSubstring = line.indexOf(\"-->\") !== -1;\n            // 34 - If we have an empty line then report the cue.\n            // 35 - If we have the special substring '-->' then report the cue,\n            // but do not collect the line as we need to process the current\n            // one as a new cue.\n            if (!line || hasSubstring && (alreadyCollectedLine = true)) {\n              // We are done parsing self cue.\n              self.oncue && self.oncue(self.cue);\n              self.cue = null;\n              self.state = \"ID\";\n              continue;\n            }\n            if (self.cue.text) {\n              self.cue.text += \"\\n\";\n            }\n            self.cue.text += line.replace(/\\u2028/g, '\\n').replace(/u2029/g, '\\n');\n            continue;\n          case \"BADCUE\":\n            // BADCUE\n            // 54-62 - Collect and discard the remaining cue.\n            if (!line) {\n              self.state = \"ID\";\n            }\n            continue;\n        }\n      }\n    } catch (e) {\n      self.reportOrThrowError(e);\n\n      // If we are currently parsing a cue, report what we have.\n      if (self.state === \"CUETEXT\" && self.cue && self.oncue) {\n        self.oncue(self.cue);\n      }\n      self.cue = null;\n      // Enter BADWEBVTT state if header was not parsed correctly otherwise\n      // another exception occurred so enter BADCUE state.\n      self.state = self.state === \"INITIAL\" ? \"BADWEBVTT\" : \"BADCUE\";\n    }\n    return this;\n  },\n  flush: function () {\n    var self = this;\n    try {\n      // Finish decoding the stream.\n      self.buffer += self.decoder.decode();\n      // Synthesize the end of the current cue or region.\n      if (self.cue || self.state === \"HEADER\") {\n        self.buffer += \"\\n\\n\";\n        self.parse();\n      }\n      // If we've flushed, parsed, and we're still on the INITIAL state then\n      // that means we don't have enough of the stream to parse the first\n      // line.\n      if (self.state === \"INITIAL\") {\n        throw new ParsingError(ParsingError.Errors.BadSignature);\n      }\n    } catch (e) {\n      self.reportOrThrowError(e);\n    }\n    self.onflush && self.onflush();\n    return this;\n  }\n};\nmodule.exports = WebVTT;","map":{"version":3,"names":["document","require","_objCreate","Object","create","F","o","arguments","length","Error","prototype","ParsingError","errorData","message","name","code","constructor","Errors","BadSignature","BadTimeStamp","parseTimeStamp","input","computeSeconds","h","m","s","f","match","replace","Settings","values","set","k","v","get","dflt","defaultKey","has","alt","a","n","integer","test","parseInt","percent","parseFloat","parseOptions","callback","keyValueDelim","groupDelim","groups","split","i","kv","trim","parseCue","cue","regionList","oInput","consumeTimeStamp","ts","consumeCueSettings","settings","id","region","vals","vals0","vertical","line","e","lineAlign","snapToLines","size","align","position","start","left","center","middle","end","right","positionAlign","skipWhitespace","startTime","substr","endTime","TEXTAREA_ELEMENT","createElement","TAG_NAME","c","b","u","ruby","rt","lang","DEFAULT_COLOR_CLASS","white","lime","cyan","red","yellow","magenta","blue","black","TAG_ANNOTATION","NEEDS_PARENT","parseContent","window","nextToken","consume","result","unescape","innerHTML","textContent","shouldAdd","current","element","localName","type","annotation","tagName","rootDiv","t","tagStack","pop","parentNode","node","createProcessingInstruction","appendChild","classes","forEach","cl","bgColor","colorName","slice","hasOwnProperty","propName","propValue","style","className","join","push","createTextNode","strongRTLRanges","isStrongRTLChar","charCode","currentRange","determineBidi","cueDiv","nodeStack","text","childNodes","pushNodes","nextTextNode","innerText","charCodeAt","computeLinePos","track","textTrackList","mediaElement","trackList","count","mode","StyleBox","applyStyles","styles","div","prop","formatStyle","val","unit","CueStyleBox","styleOptions","call","color","backgroundColor","top","bottom","display","writingMode","unicodeBidi","direction","textAlign","font","whiteSpace","textPos","width","height","move","box","BoxPosition","obj","lh","offsetHeight","offsetWidth","offsetTop","rects","getClientRects","getBoundingClientRect","Math","max","lineHeight","undefined","axis","toMove","overlaps","b2","overlapsAny","boxes","within","container","overlapsOppositeAxis","intersectPercentage","x","min","y","intersectArea","toCSSCompatValues","reference","getSimpleBoxPosition","ret","moveBoxToLinePosition","styleBox","containerBox","boxPositions","findBestPosition","bestPosition","specifiedPosition","percentage","p","boxPosition","linePos","step","round","maxPosition","initialAxis","abs","ceil","reverse","calculatedPercentage","WebVTT","StringDecoder","decode","data","decodeURIComponent","encodeURIComponent","convertCueToDOMTree","cuetext","FONT_SIZE_PERCENT","FONT_STYLE","CUE_BACKGROUND_PADDING","processCues","cues","overlay","firstChild","removeChild","paddedOverlay","margin","shouldCompute","hasBeenReset","displayState","fontSize","Parser","vttjs","decoder","state","buffer","TextDecoder","reportOrThrowError","onparsingerror","parse","self","stream","collectNextLine","pos","parseRegion","xy","anchor","VTTRegion","lines","regionAnchorX","regionAnchorY","viewportAnchorX","viewportAnchorY","scroll","onregion","parseTimestampMap","ontimestampmap","parseHeader","alreadyCollectedLine","VTTCue","indexOf","hasSubstring","oncue","flush","onflush","module","exports"],"sources":["/Users/mihailbaleev/Documents/GitHub/signal-BIT/signal/node_modules/videojs-vtt.js/lib/vtt.js"],"sourcesContent":["/**\n * Copyright 2013 vtt.js Contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n/* vim: set shiftwidth=2 tabstop=2 autoindent cindent expandtab: */\nvar document = require('global/document');\n\nvar _objCreate = Object.create || (function() {\n  function F() {}\n  return function(o) {\n    if (arguments.length !== 1) {\n      throw new Error('Object.create shim only accepts one parameter.');\n    }\n    F.prototype = o;\n    return new F();\n  };\n})();\n\n// Creates a new ParserError object from an errorData object. The errorData\n// object should have default code and message properties. The default message\n// property can be overriden by passing in a message parameter.\n// See ParsingError.Errors below for acceptable errors.\nfunction ParsingError(errorData, message) {\n  this.name = \"ParsingError\";\n  this.code = errorData.code;\n  this.message = message || errorData.message;\n}\nParsingError.prototype = _objCreate(Error.prototype);\nParsingError.prototype.constructor = ParsingError;\n\n// ParsingError metadata for acceptable ParsingErrors.\nParsingError.Errors = {\n  BadSignature: {\n    code: 0,\n    message: \"Malformed WebVTT signature.\"\n  },\n  BadTimeStamp: {\n    code: 1,\n    message: \"Malformed time stamp.\"\n  }\n};\n\n// Try to parse input as a time stamp.\nfunction parseTimeStamp(input) {\n\n  function computeSeconds(h, m, s, f) {\n    return (h | 0) * 3600 + (m | 0) * 60 + (s | 0) + (f | 0) / 1000;\n  }\n\n  var m = input.match(/^(\\d+):(\\d{1,2})(:\\d{1,2})?\\.(\\d{3})/);\n  if (!m) {\n    return null;\n  }\n\n  if (m[3]) {\n    // Timestamp takes the form of [hours]:[minutes]:[seconds].[milliseconds]\n    return computeSeconds(m[1], m[2], m[3].replace(\":\", \"\"), m[4]);\n  } else if (m[1] > 59) {\n    // Timestamp takes the form of [hours]:[minutes].[milliseconds]\n    // First position is hours as it's over 59.\n    return computeSeconds(m[1], m[2], 0,  m[4]);\n  } else {\n    // Timestamp takes the form of [minutes]:[seconds].[milliseconds]\n    return computeSeconds(0, m[1], m[2], m[4]);\n  }\n}\n\n// A settings object holds key/value pairs and will ignore anything but the first\n// assignment to a specific key.\nfunction Settings() {\n  this.values = _objCreate(null);\n}\n\nSettings.prototype = {\n  // Only accept the first assignment to any key.\n  set: function(k, v) {\n    if (!this.get(k) && v !== \"\") {\n      this.values[k] = v;\n    }\n  },\n  // Return the value for a key, or a default value.\n  // If 'defaultKey' is passed then 'dflt' is assumed to be an object with\n  // a number of possible default values as properties where 'defaultKey' is\n  // the key of the property that will be chosen; otherwise it's assumed to be\n  // a single value.\n  get: function(k, dflt, defaultKey) {\n    if (defaultKey) {\n      return this.has(k) ? this.values[k] : dflt[defaultKey];\n    }\n    return this.has(k) ? this.values[k] : dflt;\n  },\n  // Check whether we have a value for a key.\n  has: function(k) {\n    return k in this.values;\n  },\n  // Accept a setting if its one of the given alternatives.\n  alt: function(k, v, a) {\n    for (var n = 0; n < a.length; ++n) {\n      if (v === a[n]) {\n        this.set(k, v);\n        break;\n      }\n    }\n  },\n  // Accept a setting if its a valid (signed) integer.\n  integer: function(k, v) {\n    if (/^-?\\d+$/.test(v)) { // integer\n      this.set(k, parseInt(v, 10));\n    }\n  },\n  // Accept a setting if its a valid percentage.\n  percent: function(k, v) {\n    var m;\n    if ((m = v.match(/^([\\d]{1,3})(\\.[\\d]*)?%$/))) {\n      v = parseFloat(v);\n      if (v >= 0 && v <= 100) {\n        this.set(k, v);\n        return true;\n      }\n    }\n    return false;\n  }\n};\n\n// Helper function to parse input into groups separated by 'groupDelim', and\n// interprete each group as a key/value pair separated by 'keyValueDelim'.\nfunction parseOptions(input, callback, keyValueDelim, groupDelim) {\n  var groups = groupDelim ? input.split(groupDelim) : [input];\n  for (var i in groups) {\n    if (typeof groups[i] !== \"string\") {\n      continue;\n    }\n    var kv = groups[i].split(keyValueDelim);\n    if (kv.length !== 2) {\n      continue;\n    }\n    var k = kv[0].trim();\n    var v = kv[1].trim();\n    callback(k, v);\n  }\n}\n\nfunction parseCue(input, cue, regionList) {\n  // Remember the original input if we need to throw an error.\n  var oInput = input;\n  // 4.1 WebVTT timestamp\n  function consumeTimeStamp() {\n    var ts = parseTimeStamp(input);\n    if (ts === null) {\n      throw new ParsingError(ParsingError.Errors.BadTimeStamp,\n                            \"Malformed timestamp: \" + oInput);\n    }\n    // Remove time stamp from input.\n    input = input.replace(/^[^\\sa-zA-Z-]+/, \"\");\n    return ts;\n  }\n\n  // 4.4.2 WebVTT cue settings\n  function consumeCueSettings(input, cue) {\n    var settings = new Settings();\n\n    parseOptions(input, function (k, v) {\n      switch (k) {\n      case \"region\":\n        // Find the last region we parsed with the same region id.\n        for (var i = regionList.length - 1; i >= 0; i--) {\n          if (regionList[i].id === v) {\n            settings.set(k, regionList[i].region);\n            break;\n          }\n        }\n        break;\n      case \"vertical\":\n        settings.alt(k, v, [\"rl\", \"lr\"]);\n        break;\n      case \"line\":\n        var vals = v.split(\",\"),\n            vals0 = vals[0];\n        settings.integer(k, vals0);\n        settings.percent(k, vals0) ? settings.set(\"snapToLines\", false) : null;\n        settings.alt(k, vals0, [\"auto\"]);\n        if (vals.length === 2) {\n          settings.alt(\"lineAlign\", vals[1], [\"start\", \"center\", \"end\"]);\n        }\n        break;\n      case \"position\":\n        vals = v.split(\",\");\n        settings.percent(k, vals[0]);\n        if (vals.length === 2) {\n          settings.alt(\"positionAlign\", vals[1], [\"start\", \"center\", \"end\"]);\n        }\n        break;\n      case \"size\":\n        settings.percent(k, v);\n        break;\n      case \"align\":\n        settings.alt(k, v, [\"start\", \"center\", \"end\", \"left\", \"right\"]);\n        break;\n      }\n    }, /:/, /\\s/);\n\n    // Apply default values for any missing fields.\n    cue.region = settings.get(\"region\", null);\n    cue.vertical = settings.get(\"vertical\", \"\");\n    try {\n      cue.line = settings.get(\"line\", \"auto\");\n    } catch (e) {}\n    cue.lineAlign = settings.get(\"lineAlign\", \"start\");\n    cue.snapToLines = settings.get(\"snapToLines\", true);\n    cue.size = settings.get(\"size\", 100);\n    // Safari still uses the old middle value and won't accept center\n    try {\n      cue.align = settings.get(\"align\", \"center\");\n    } catch (e) {\n      cue.align = settings.get(\"align\", \"middle\");\n    }\n    try {\n      cue.position = settings.get(\"position\", \"auto\");\n    } catch (e) {\n      cue.position = settings.get(\"position\", {\n        start: 0,\n        left: 0,\n        center: 50,\n        middle: 50,\n        end: 100,\n        right: 100\n      }, cue.align);\n    }\n\n\n    cue.positionAlign = settings.get(\"positionAlign\", {\n      start: \"start\",\n      left: \"start\",\n      center: \"center\",\n      middle: \"center\",\n      end: \"end\",\n      right: \"end\"\n    }, cue.align);\n  }\n\n  function skipWhitespace() {\n    input = input.replace(/^\\s+/, \"\");\n  }\n\n  // 4.1 WebVTT cue timings.\n  skipWhitespace();\n  cue.startTime = consumeTimeStamp();   // (1) collect cue start time\n  skipWhitespace();\n  if (input.substr(0, 3) !== \"-->\") {     // (3) next characters must match \"-->\"\n    throw new ParsingError(ParsingError.Errors.BadTimeStamp,\n                           \"Malformed time stamp (time stamps must be separated by '-->'): \" +\n                           oInput);\n  }\n  input = input.substr(3);\n  skipWhitespace();\n  cue.endTime = consumeTimeStamp();     // (5) collect cue end time\n\n  // 4.1 WebVTT cue settings list.\n  skipWhitespace();\n  consumeCueSettings(input, cue);\n}\n\n// When evaluating this file as part of a Webpack bundle for server\n// side rendering, `document` is an empty object.\nvar TEXTAREA_ELEMENT = document.createElement && document.createElement(\"textarea\");\n\nvar TAG_NAME = {\n  c: \"span\",\n  i: \"i\",\n  b: \"b\",\n  u: \"u\",\n  ruby: \"ruby\",\n  rt: \"rt\",\n  v: \"span\",\n  lang: \"span\"\n};\n\n// 5.1 default text color\n// 5.2 default text background color is equivalent to text color with bg_ prefix\nvar DEFAULT_COLOR_CLASS = {\n  white: 'rgba(255,255,255,1)',\n  lime: 'rgba(0,255,0,1)',\n  cyan: 'rgba(0,255,255,1)',\n  red: 'rgba(255,0,0,1)',\n  yellow: 'rgba(255,255,0,1)',\n  magenta: 'rgba(255,0,255,1)',\n  blue: 'rgba(0,0,255,1)',\n  black: 'rgba(0,0,0,1)'\n};\n\nvar TAG_ANNOTATION = {\n  v: \"title\",\n  lang: \"lang\"\n};\n\nvar NEEDS_PARENT = {\n  rt: \"ruby\"\n};\n\n// Parse content into a document fragment.\nfunction parseContent(window, input) {\n  function nextToken() {\n    // Check for end-of-string.\n    if (!input) {\n      return null;\n    }\n\n    // Consume 'n' characters from the input.\n    function consume(result) {\n      input = input.substr(result.length);\n      return result;\n    }\n\n    var m = input.match(/^([^<]*)(<[^>]*>?)?/);\n    // If there is some text before the next tag, return it, otherwise return\n    // the tag.\n    return consume(m[1] ? m[1] : m[2]);\n  }\n\n  function unescape(s) {\n    TEXTAREA_ELEMENT.innerHTML = s;\n    s = TEXTAREA_ELEMENT.textContent;\n    TEXTAREA_ELEMENT.textContent = \"\";\n    return s;\n  }\n\n  function shouldAdd(current, element) {\n    return !NEEDS_PARENT[element.localName] ||\n           NEEDS_PARENT[element.localName] === current.localName;\n  }\n\n  // Create an element for this tag.\n  function createElement(type, annotation) {\n    var tagName = TAG_NAME[type];\n    if (!tagName) {\n      return null;\n    }\n    var element = window.document.createElement(tagName);\n    var name = TAG_ANNOTATION[type];\n    if (name && annotation) {\n      element[name] = annotation.trim();\n    }\n    return element;\n  }\n\n  var rootDiv = window.document.createElement(\"div\"),\n      current = rootDiv,\n      t,\n      tagStack = [];\n\n  while ((t = nextToken()) !== null) {\n    if (t[0] === '<') {\n      if (t[1] === \"/\") {\n        // If the closing tag matches, move back up to the parent node.\n        if (tagStack.length &&\n            tagStack[tagStack.length - 1] === t.substr(2).replace(\">\", \"\")) {\n          tagStack.pop();\n          current = current.parentNode;\n        }\n        // Otherwise just ignore the end tag.\n        continue;\n      }\n      var ts = parseTimeStamp(t.substr(1, t.length - 2));\n      var node;\n      if (ts) {\n        // Timestamps are lead nodes as well.\n        node = window.document.createProcessingInstruction(\"timestamp\", ts);\n        current.appendChild(node);\n        continue;\n      }\n      var m = t.match(/^<([^.\\s/0-9>]+)(\\.[^\\s\\\\>]+)?([^>\\\\]+)?(\\\\?)>?$/);\n      // If we can't parse the tag, skip to the next tag.\n      if (!m) {\n        continue;\n      }\n      // Try to construct an element, and ignore the tag if we couldn't.\n      node = createElement(m[1], m[3]);\n      if (!node) {\n        continue;\n      }\n      // Determine if the tag should be added based on the context of where it\n      // is placed in the cuetext.\n      if (!shouldAdd(current, node)) {\n        continue;\n      }\n      // Set the class list (as a list of classes, separated by space).\n      if (m[2]) {\n        var classes = m[2].split('.');\n\n        classes.forEach(function(cl) {\n          var bgColor = /^bg_/.test(cl);\n          // slice out `bg_` if it's a background color\n          var colorName = bgColor ? cl.slice(3) : cl;\n\n          if (DEFAULT_COLOR_CLASS.hasOwnProperty(colorName)) {\n            var propName = bgColor ? 'background-color' : 'color';\n            var propValue = DEFAULT_COLOR_CLASS[colorName];\n\n            node.style[propName] = propValue;\n          }\n        });\n\n        node.className = classes.join(' ');\n      }\n      // Append the node to the current node, and enter the scope of the new\n      // node.\n      tagStack.push(m[1]);\n      current.appendChild(node);\n      current = node;\n      continue;\n    }\n\n    // Text nodes are leaf nodes.\n    current.appendChild(window.document.createTextNode(unescape(t)));\n  }\n\n  return rootDiv;\n}\n\n// This is a list of all the Unicode characters that have a strong\n// right-to-left category. What this means is that these characters are\n// written right-to-left for sure. It was generated by pulling all the strong\n// right-to-left characters out of the Unicode data table. That table can\n// found at: http://www.unicode.org/Public/UNIDATA/UnicodeData.txt\nvar strongRTLRanges = [[0x5be, 0x5be], [0x5c0, 0x5c0], [0x5c3, 0x5c3], [0x5c6, 0x5c6],\n [0x5d0, 0x5ea], [0x5f0, 0x5f4], [0x608, 0x608], [0x60b, 0x60b], [0x60d, 0x60d],\n [0x61b, 0x61b], [0x61e, 0x64a], [0x66d, 0x66f], [0x671, 0x6d5], [0x6e5, 0x6e6],\n [0x6ee, 0x6ef], [0x6fa, 0x70d], [0x70f, 0x710], [0x712, 0x72f], [0x74d, 0x7a5],\n [0x7b1, 0x7b1], [0x7c0, 0x7ea], [0x7f4, 0x7f5], [0x7fa, 0x7fa], [0x800, 0x815],\n [0x81a, 0x81a], [0x824, 0x824], [0x828, 0x828], [0x830, 0x83e], [0x840, 0x858],\n [0x85e, 0x85e], [0x8a0, 0x8a0], [0x8a2, 0x8ac], [0x200f, 0x200f],\n [0xfb1d, 0xfb1d], [0xfb1f, 0xfb28], [0xfb2a, 0xfb36], [0xfb38, 0xfb3c],\n [0xfb3e, 0xfb3e], [0xfb40, 0xfb41], [0xfb43, 0xfb44], [0xfb46, 0xfbc1],\n [0xfbd3, 0xfd3d], [0xfd50, 0xfd8f], [0xfd92, 0xfdc7], [0xfdf0, 0xfdfc],\n [0xfe70, 0xfe74], [0xfe76, 0xfefc], [0x10800, 0x10805], [0x10808, 0x10808],\n [0x1080a, 0x10835], [0x10837, 0x10838], [0x1083c, 0x1083c], [0x1083f, 0x10855],\n [0x10857, 0x1085f], [0x10900, 0x1091b], [0x10920, 0x10939], [0x1093f, 0x1093f],\n [0x10980, 0x109b7], [0x109be, 0x109bf], [0x10a00, 0x10a00], [0x10a10, 0x10a13],\n [0x10a15, 0x10a17], [0x10a19, 0x10a33], [0x10a40, 0x10a47], [0x10a50, 0x10a58],\n [0x10a60, 0x10a7f], [0x10b00, 0x10b35], [0x10b40, 0x10b55], [0x10b58, 0x10b72],\n [0x10b78, 0x10b7f], [0x10c00, 0x10c48], [0x1ee00, 0x1ee03], [0x1ee05, 0x1ee1f],\n [0x1ee21, 0x1ee22], [0x1ee24, 0x1ee24], [0x1ee27, 0x1ee27], [0x1ee29, 0x1ee32],\n [0x1ee34, 0x1ee37], [0x1ee39, 0x1ee39], [0x1ee3b, 0x1ee3b], [0x1ee42, 0x1ee42],\n [0x1ee47, 0x1ee47], [0x1ee49, 0x1ee49], [0x1ee4b, 0x1ee4b], [0x1ee4d, 0x1ee4f],\n [0x1ee51, 0x1ee52], [0x1ee54, 0x1ee54], [0x1ee57, 0x1ee57], [0x1ee59, 0x1ee59],\n [0x1ee5b, 0x1ee5b], [0x1ee5d, 0x1ee5d], [0x1ee5f, 0x1ee5f], [0x1ee61, 0x1ee62],\n [0x1ee64, 0x1ee64], [0x1ee67, 0x1ee6a], [0x1ee6c, 0x1ee72], [0x1ee74, 0x1ee77],\n [0x1ee79, 0x1ee7c], [0x1ee7e, 0x1ee7e], [0x1ee80, 0x1ee89], [0x1ee8b, 0x1ee9b],\n [0x1eea1, 0x1eea3], [0x1eea5, 0x1eea9], [0x1eeab, 0x1eebb], [0x10fffd, 0x10fffd]];\n\nfunction isStrongRTLChar(charCode) {\n  for (var i = 0; i < strongRTLRanges.length; i++) {\n    var currentRange = strongRTLRanges[i];\n    if (charCode >= currentRange[0] && charCode <= currentRange[1]) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction determineBidi(cueDiv) {\n  var nodeStack = [],\n      text = \"\",\n      charCode;\n\n  if (!cueDiv || !cueDiv.childNodes) {\n    return \"ltr\";\n  }\n\n  function pushNodes(nodeStack, node) {\n    for (var i = node.childNodes.length - 1; i >= 0; i--) {\n      nodeStack.push(node.childNodes[i]);\n    }\n  }\n\n  function nextTextNode(nodeStack) {\n    if (!nodeStack || !nodeStack.length) {\n      return null;\n    }\n\n    var node = nodeStack.pop(),\n        text = node.textContent || node.innerText;\n    if (text) {\n      // TODO: This should match all unicode type B characters (paragraph\n      // separator characters). See issue #115.\n      var m = text.match(/^.*(\\n|\\r)/);\n      if (m) {\n        nodeStack.length = 0;\n        return m[0];\n      }\n      return text;\n    }\n    if (node.tagName === \"ruby\") {\n      return nextTextNode(nodeStack);\n    }\n    if (node.childNodes) {\n      pushNodes(nodeStack, node);\n      return nextTextNode(nodeStack);\n    }\n  }\n\n  pushNodes(nodeStack, cueDiv);\n  while ((text = nextTextNode(nodeStack))) {\n    for (var i = 0; i < text.length; i++) {\n      charCode = text.charCodeAt(i);\n      if (isStrongRTLChar(charCode)) {\n        return \"rtl\";\n      }\n    }\n  }\n  return \"ltr\";\n}\n\nfunction computeLinePos(cue) {\n  if (typeof cue.line === \"number\" &&\n      (cue.snapToLines || (cue.line >= 0 && cue.line <= 100))) {\n    return cue.line;\n  }\n  if (!cue.track || !cue.track.textTrackList ||\n      !cue.track.textTrackList.mediaElement) {\n    return -1;\n  }\n  var track = cue.track,\n      trackList = track.textTrackList,\n      count = 0;\n  for (var i = 0; i < trackList.length && trackList[i] !== track; i++) {\n    if (trackList[i].mode === \"showing\") {\n      count++;\n    }\n  }\n  return ++count * -1;\n}\n\nfunction StyleBox() {\n}\n\n// Apply styles to a div. If there is no div passed then it defaults to the\n// div on 'this'.\nStyleBox.prototype.applyStyles = function(styles, div) {\n  div = div || this.div;\n  for (var prop in styles) {\n    if (styles.hasOwnProperty(prop)) {\n      div.style[prop] = styles[prop];\n    }\n  }\n};\n\nStyleBox.prototype.formatStyle = function(val, unit) {\n  return val === 0 ? 0 : val + unit;\n};\n\n// Constructs the computed display state of the cue (a div). Places the div\n// into the overlay which should be a block level element (usually a div).\nfunction CueStyleBox(window, cue, styleOptions) {\n  StyleBox.call(this);\n  this.cue = cue;\n\n  // Parse our cue's text into a DOM tree rooted at 'cueDiv'. This div will\n  // have inline positioning and will function as the cue background box.\n  this.cueDiv = parseContent(window, cue.text);\n  var styles = {\n    color: \"rgba(255, 255, 255, 1)\",\n    backgroundColor:  \"rgba(0, 0, 0, 0.8)\",\n    position: \"relative\",\n    left: 0,\n    right: 0,\n    top: 0,\n    bottom: 0,\n    display: \"inline\",\n    writingMode: cue.vertical === \"\" ? \"horizontal-tb\"\n                                     : cue.vertical === \"lr\" ? \"vertical-lr\"\n                                                             : \"vertical-rl\",\n    unicodeBidi: \"plaintext\"\n  };\n\n  this.applyStyles(styles, this.cueDiv);\n\n  // Create an absolutely positioned div that will be used to position the cue\n  // div. Note, all WebVTT cue-setting alignments are equivalent to the CSS\n  // mirrors of them except middle instead of center on Safari.\n  this.div = window.document.createElement(\"div\");\n  styles = {\n    direction: determineBidi(this.cueDiv),\n    writingMode: cue.vertical === \"\" ? \"horizontal-tb\"\n                                     : cue.vertical === \"lr\" ? \"vertical-lr\"\n                                                             : \"vertical-rl\",\n    unicodeBidi: \"plaintext\",\n    textAlign: cue.align === \"middle\" ? \"center\" : cue.align,\n    font: styleOptions.font,\n    whiteSpace: \"pre-line\",\n    position: \"absolute\"\n  };\n\n  this.applyStyles(styles);\n  this.div.appendChild(this.cueDiv);\n\n  // Calculate the distance from the reference edge of the viewport to the text\n  // position of the cue box. The reference edge will be resolved later when\n  // the box orientation styles are applied.\n  var textPos = 0;\n  switch (cue.positionAlign) {\n  case \"start\":\n  case \"line-left\":\n    textPos = cue.position;\n    break;\n  case \"center\":\n    textPos = cue.position - (cue.size / 2);\n    break;\n  case \"end\":\n  case \"line-right\":\n    textPos = cue.position - cue.size;\n    break;\n  }\n\n  // Horizontal box orientation; textPos is the distance from the left edge of the\n  // area to the left edge of the box and cue.size is the distance extending to\n  // the right from there.\n  if (cue.vertical === \"\") {\n    this.applyStyles({\n      left:  this.formatStyle(textPos, \"%\"),\n      width: this.formatStyle(cue.size, \"%\")\n    });\n  // Vertical box orientation; textPos is the distance from the top edge of the\n  // area to the top edge of the box and cue.size is the height extending\n  // downwards from there.\n  } else {\n    this.applyStyles({\n      top: this.formatStyle(textPos, \"%\"),\n      height: this.formatStyle(cue.size, \"%\")\n    });\n  }\n\n  this.move = function(box) {\n    this.applyStyles({\n      top: this.formatStyle(box.top, \"px\"),\n      bottom: this.formatStyle(box.bottom, \"px\"),\n      left: this.formatStyle(box.left, \"px\"),\n      right: this.formatStyle(box.right, \"px\"),\n      height: this.formatStyle(box.height, \"px\"),\n      width: this.formatStyle(box.width, \"px\")\n    });\n  };\n}\nCueStyleBox.prototype = _objCreate(StyleBox.prototype);\nCueStyleBox.prototype.constructor = CueStyleBox;\n\n// Represents the co-ordinates of an Element in a way that we can easily\n// compute things with such as if it overlaps or intersects with another Element.\n// Can initialize it with either a StyleBox or another BoxPosition.\nfunction BoxPosition(obj) {\n  // Either a BoxPosition was passed in and we need to copy it, or a StyleBox\n  // was passed in and we need to copy the results of 'getBoundingClientRect'\n  // as the object returned is readonly. All co-ordinate values are in reference\n  // to the viewport origin (top left).\n  var lh, height, width, top;\n  if (obj.div) {\n    height = obj.div.offsetHeight;\n    width = obj.div.offsetWidth;\n    top = obj.div.offsetTop;\n\n    var rects = (rects = obj.div.childNodes) && (rects = rects[0]) &&\n                rects.getClientRects && rects.getClientRects();\n    obj = obj.div.getBoundingClientRect();\n    // In certain cases the outter div will be slightly larger then the sum of\n    // the inner div's lines. This could be due to bold text, etc, on some platforms.\n    // In this case we should get the average line height and use that. This will\n    // result in the desired behaviour.\n    lh = rects ? Math.max((rects[0] && rects[0].height) || 0, obj.height / rects.length)\n               : 0;\n\n  }\n  this.left = obj.left;\n  this.right = obj.right;\n  this.top = obj.top || top;\n  this.height = obj.height || height;\n  this.bottom = obj.bottom || (top + (obj.height || height));\n  this.width = obj.width || width;\n  this.lineHeight = lh !== undefined ? lh : obj.lineHeight;\n}\n\n// Move the box along a particular axis. Optionally pass in an amount to move\n// the box. If no amount is passed then the default is the line height of the\n// box.\nBoxPosition.prototype.move = function(axis, toMove) {\n  toMove = toMove !== undefined ? toMove : this.lineHeight;\n  switch (axis) {\n  case \"+x\":\n    this.left += toMove;\n    this.right += toMove;\n    break;\n  case \"-x\":\n    this.left -= toMove;\n    this.right -= toMove;\n    break;\n  case \"+y\":\n    this.top += toMove;\n    this.bottom += toMove;\n    break;\n  case \"-y\":\n    this.top -= toMove;\n    this.bottom -= toMove;\n    break;\n  }\n};\n\n// Check if this box overlaps another box, b2.\nBoxPosition.prototype.overlaps = function(b2) {\n  return this.left < b2.right &&\n         this.right > b2.left &&\n         this.top < b2.bottom &&\n         this.bottom > b2.top;\n};\n\n// Check if this box overlaps any other boxes in boxes.\nBoxPosition.prototype.overlapsAny = function(boxes) {\n  for (var i = 0; i < boxes.length; i++) {\n    if (this.overlaps(boxes[i])) {\n      return true;\n    }\n  }\n  return false;\n};\n\n// Check if this box is within another box.\nBoxPosition.prototype.within = function(container) {\n  return this.top >= container.top &&\n         this.bottom <= container.bottom &&\n         this.left >= container.left &&\n         this.right <= container.right;\n};\n\n// Check if this box is entirely within the container or it is overlapping\n// on the edge opposite of the axis direction passed. For example, if \"+x\" is\n// passed and the box is overlapping on the left edge of the container, then\n// return true.\nBoxPosition.prototype.overlapsOppositeAxis = function(container, axis) {\n  switch (axis) {\n  case \"+x\":\n    return this.left < container.left;\n  case \"-x\":\n    return this.right > container.right;\n  case \"+y\":\n    return this.top < container.top;\n  case \"-y\":\n    return this.bottom > container.bottom;\n  }\n};\n\n// Find the percentage of the area that this box is overlapping with another\n// box.\nBoxPosition.prototype.intersectPercentage = function(b2) {\n  var x = Math.max(0, Math.min(this.right, b2.right) - Math.max(this.left, b2.left)),\n      y = Math.max(0, Math.min(this.bottom, b2.bottom) - Math.max(this.top, b2.top)),\n      intersectArea = x * y;\n  return intersectArea / (this.height * this.width);\n};\n\n// Convert the positions from this box to CSS compatible positions using\n// the reference container's positions. This has to be done because this\n// box's positions are in reference to the viewport origin, whereas, CSS\n// values are in referecne to their respective edges.\nBoxPosition.prototype.toCSSCompatValues = function(reference) {\n  return {\n    top: this.top - reference.top,\n    bottom: reference.bottom - this.bottom,\n    left: this.left - reference.left,\n    right: reference.right - this.right,\n    height: this.height,\n    width: this.width\n  };\n};\n\n// Get an object that represents the box's position without anything extra.\n// Can pass a StyleBox, HTMLElement, or another BoxPositon.\nBoxPosition.getSimpleBoxPosition = function(obj) {\n  var height = obj.div ? obj.div.offsetHeight : obj.tagName ? obj.offsetHeight : 0;\n  var width = obj.div ? obj.div.offsetWidth : obj.tagName ? obj.offsetWidth : 0;\n  var top = obj.div ? obj.div.offsetTop : obj.tagName ? obj.offsetTop : 0;\n\n  obj = obj.div ? obj.div.getBoundingClientRect() :\n                obj.tagName ? obj.getBoundingClientRect() : obj;\n  var ret = {\n    left: obj.left,\n    right: obj.right,\n    top: obj.top || top,\n    height: obj.height || height,\n    bottom: obj.bottom || (top + (obj.height || height)),\n    width: obj.width || width\n  };\n  return ret;\n};\n\n// Move a StyleBox to its specified, or next best, position. The containerBox\n// is the box that contains the StyleBox, such as a div. boxPositions are\n// a list of other boxes that the styleBox can't overlap with.\nfunction moveBoxToLinePosition(window, styleBox, containerBox, boxPositions) {\n\n  // Find the best position for a cue box, b, on the video. The axis parameter\n  // is a list of axis, the order of which, it will move the box along. For example:\n  // Passing [\"+x\", \"-x\"] will move the box first along the x axis in the positive\n  // direction. If it doesn't find a good position for it there it will then move\n  // it along the x axis in the negative direction.\n  function findBestPosition(b, axis) {\n    var bestPosition,\n        specifiedPosition = new BoxPosition(b),\n        percentage = 1; // Highest possible so the first thing we get is better.\n\n    for (var i = 0; i < axis.length; i++) {\n      while (b.overlapsOppositeAxis(containerBox, axis[i]) ||\n             (b.within(containerBox) && b.overlapsAny(boxPositions))) {\n        b.move(axis[i]);\n      }\n      // We found a spot where we aren't overlapping anything. This is our\n      // best position.\n      if (b.within(containerBox)) {\n        return b;\n      }\n      var p = b.intersectPercentage(containerBox);\n      // If we're outside the container box less then we were on our last try\n      // then remember this position as the best position.\n      if (percentage > p) {\n        bestPosition = new BoxPosition(b);\n        percentage = p;\n      }\n      // Reset the box position to the specified position.\n      b = new BoxPosition(specifiedPosition);\n    }\n    return bestPosition || specifiedPosition;\n  }\n\n  var boxPosition = new BoxPosition(styleBox),\n      cue = styleBox.cue,\n      linePos = computeLinePos(cue),\n      axis = [];\n\n  // If we have a line number to align the cue to.\n  if (cue.snapToLines) {\n    var size;\n    switch (cue.vertical) {\n    case \"\":\n      axis = [ \"+y\", \"-y\" ];\n      size = \"height\";\n      break;\n    case \"rl\":\n      axis = [ \"+x\", \"-x\" ];\n      size = \"width\";\n      break;\n    case \"lr\":\n      axis = [ \"-x\", \"+x\" ];\n      size = \"width\";\n      break;\n    }\n\n    var step = boxPosition.lineHeight,\n        position = step * Math.round(linePos),\n        maxPosition = containerBox[size] + step,\n        initialAxis = axis[0];\n\n    // If the specified intial position is greater then the max position then\n    // clamp the box to the amount of steps it would take for the box to\n    // reach the max position.\n    if (Math.abs(position) > maxPosition) {\n      position = position < 0 ? -1 : 1;\n      position *= Math.ceil(maxPosition / step) * step;\n    }\n\n    // If computed line position returns negative then line numbers are\n    // relative to the bottom of the video instead of the top. Therefore, we\n    // need to increase our initial position by the length or width of the\n    // video, depending on the writing direction, and reverse our axis directions.\n    if (linePos < 0) {\n      position += cue.vertical === \"\" ? containerBox.height : containerBox.width;\n      axis = axis.reverse();\n    }\n\n    // Move the box to the specified position. This may not be its best\n    // position.\n    boxPosition.move(initialAxis, position);\n\n  } else {\n    // If we have a percentage line value for the cue.\n    var calculatedPercentage = (boxPosition.lineHeight / containerBox.height) * 100;\n\n    switch (cue.lineAlign) {\n    case \"center\":\n      linePos -= (calculatedPercentage / 2);\n      break;\n    case \"end\":\n      linePos -= calculatedPercentage;\n      break;\n    }\n\n    // Apply initial line position to the cue box.\n    switch (cue.vertical) {\n    case \"\":\n      styleBox.applyStyles({\n        top: styleBox.formatStyle(linePos, \"%\")\n      });\n      break;\n    case \"rl\":\n      styleBox.applyStyles({\n        left: styleBox.formatStyle(linePos, \"%\")\n      });\n      break;\n    case \"lr\":\n      styleBox.applyStyles({\n        right: styleBox.formatStyle(linePos, \"%\")\n      });\n      break;\n    }\n\n    axis = [ \"+y\", \"-x\", \"+x\", \"-y\" ];\n\n    // Get the box position again after we've applied the specified positioning\n    // to it.\n    boxPosition = new BoxPosition(styleBox);\n  }\n\n  var bestPosition = findBestPosition(boxPosition, axis);\n  styleBox.move(bestPosition.toCSSCompatValues(containerBox));\n}\n\nfunction WebVTT() {\n  // Nothing\n}\n\n// Helper to allow strings to be decoded instead of the default binary utf8 data.\nWebVTT.StringDecoder = function() {\n  return {\n    decode: function(data) {\n      if (!data) {\n        return \"\";\n      }\n      if (typeof data !== \"string\") {\n        throw new Error(\"Error - expected string data.\");\n      }\n      return decodeURIComponent(encodeURIComponent(data));\n    }\n  };\n};\n\nWebVTT.convertCueToDOMTree = function(window, cuetext) {\n  if (!window || !cuetext) {\n    return null;\n  }\n  return parseContent(window, cuetext);\n};\n\nvar FONT_SIZE_PERCENT = 0.05;\nvar FONT_STYLE = \"sans-serif\";\nvar CUE_BACKGROUND_PADDING = \"1.5%\";\n\n// Runs the processing model over the cues and regions passed to it.\n// @param overlay A block level element (usually a div) that the computed cues\n//                and regions will be placed into.\nWebVTT.processCues = function(window, cues, overlay) {\n  if (!window || !cues || !overlay) {\n    return null;\n  }\n\n  // Remove all previous children.\n  while (overlay.firstChild) {\n    overlay.removeChild(overlay.firstChild);\n  }\n\n  var paddedOverlay = window.document.createElement(\"div\");\n  paddedOverlay.style.position = \"absolute\";\n  paddedOverlay.style.left = \"0\";\n  paddedOverlay.style.right = \"0\";\n  paddedOverlay.style.top = \"0\";\n  paddedOverlay.style.bottom = \"0\";\n  paddedOverlay.style.margin = CUE_BACKGROUND_PADDING;\n  overlay.appendChild(paddedOverlay);\n\n  // Determine if we need to compute the display states of the cues. This could\n  // be the case if a cue's state has been changed since the last computation or\n  // if it has not been computed yet.\n  function shouldCompute(cues) {\n    for (var i = 0; i < cues.length; i++) {\n      if (cues[i].hasBeenReset || !cues[i].displayState) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  // We don't need to recompute the cues' display states. Just reuse them.\n  if (!shouldCompute(cues)) {\n    for (var i = 0; i < cues.length; i++) {\n      paddedOverlay.appendChild(cues[i].displayState);\n    }\n    return;\n  }\n\n  var boxPositions = [],\n      containerBox = BoxPosition.getSimpleBoxPosition(paddedOverlay),\n      fontSize = Math.round(containerBox.height * FONT_SIZE_PERCENT * 100) / 100;\n  var styleOptions = {\n    font: fontSize + \"px \" + FONT_STYLE\n  };\n\n  (function() {\n    var styleBox, cue;\n\n    for (var i = 0; i < cues.length; i++) {\n      cue = cues[i];\n\n      // Compute the intial position and styles of the cue div.\n      styleBox = new CueStyleBox(window, cue, styleOptions);\n      paddedOverlay.appendChild(styleBox.div);\n\n      // Move the cue div to it's correct line position.\n      moveBoxToLinePosition(window, styleBox, containerBox, boxPositions);\n\n      // Remember the computed div so that we don't have to recompute it later\n      // if we don't have too.\n      cue.displayState = styleBox.div;\n\n      boxPositions.push(BoxPosition.getSimpleBoxPosition(styleBox));\n    }\n  })();\n};\n\nWebVTT.Parser = function(window, vttjs, decoder) {\n  if (!decoder) {\n    decoder = vttjs;\n    vttjs = {};\n  }\n  if (!vttjs) {\n    vttjs = {};\n  }\n\n  this.window = window;\n  this.vttjs = vttjs;\n  this.state = \"INITIAL\";\n  this.buffer = \"\";\n  this.decoder = decoder || new TextDecoder(\"utf8\");\n  this.regionList = [];\n};\n\nWebVTT.Parser.prototype = {\n  // If the error is a ParsingError then report it to the consumer if\n  // possible. If it's not a ParsingError then throw it like normal.\n  reportOrThrowError: function(e) {\n    if (e instanceof ParsingError) {\n      this.onparsingerror && this.onparsingerror(e);\n    } else {\n      throw e;\n    }\n  },\n  parse: function (data) {\n    var self = this;\n\n    // If there is no data then we won't decode it, but will just try to parse\n    // whatever is in buffer already. This may occur in circumstances, for\n    // example when flush() is called.\n    if (data) {\n      // Try to decode the data that we received.\n      self.buffer += self.decoder.decode(data, {stream: true});\n    }\n\n    function collectNextLine() {\n      var buffer = self.buffer;\n      var pos = 0;\n      while (pos < buffer.length && buffer[pos] !== '\\r' && buffer[pos] !== '\\n') {\n        ++pos;\n      }\n      var line = buffer.substr(0, pos);\n      // Advance the buffer early in case we fail below.\n      if (buffer[pos] === '\\r') {\n        ++pos;\n      }\n      if (buffer[pos] === '\\n') {\n        ++pos;\n      }\n      self.buffer = buffer.substr(pos);\n      return line;\n    }\n\n    // 3.4 WebVTT region and WebVTT region settings syntax\n    function parseRegion(input) {\n      var settings = new Settings();\n\n      parseOptions(input, function (k, v) {\n        switch (k) {\n        case \"id\":\n          settings.set(k, v);\n          break;\n        case \"width\":\n          settings.percent(k, v);\n          break;\n        case \"lines\":\n          settings.integer(k, v);\n          break;\n        case \"regionanchor\":\n        case \"viewportanchor\":\n          var xy = v.split(',');\n          if (xy.length !== 2) {\n            break;\n          }\n          // We have to make sure both x and y parse, so use a temporary\n          // settings object here.\n          var anchor = new Settings();\n          anchor.percent(\"x\", xy[0]);\n          anchor.percent(\"y\", xy[1]);\n          if (!anchor.has(\"x\") || !anchor.has(\"y\")) {\n            break;\n          }\n          settings.set(k + \"X\", anchor.get(\"x\"));\n          settings.set(k + \"Y\", anchor.get(\"y\"));\n          break;\n        case \"scroll\":\n          settings.alt(k, v, [\"up\"]);\n          break;\n        }\n      }, /=/, /\\s/);\n\n      // Create the region, using default values for any values that were not\n      // specified.\n      if (settings.has(\"id\")) {\n        var region = new (self.vttjs.VTTRegion || self.window.VTTRegion)();\n        region.width = settings.get(\"width\", 100);\n        region.lines = settings.get(\"lines\", 3);\n        region.regionAnchorX = settings.get(\"regionanchorX\", 0);\n        region.regionAnchorY = settings.get(\"regionanchorY\", 100);\n        region.viewportAnchorX = settings.get(\"viewportanchorX\", 0);\n        region.viewportAnchorY = settings.get(\"viewportanchorY\", 100);\n        region.scroll = settings.get(\"scroll\", \"\");\n        // Register the region.\n        self.onregion && self.onregion(region);\n        // Remember the VTTRegion for later in case we parse any VTTCues that\n        // reference it.\n        self.regionList.push({\n          id: settings.get(\"id\"),\n          region: region\n        });\n      }\n    }\n\n    // draft-pantos-http-live-streaming-20\n    // https://tools.ietf.org/html/draft-pantos-http-live-streaming-20#section-3.5\n    // 3.5 WebVTT\n    function parseTimestampMap(input) {\n      var settings = new Settings();\n\n      parseOptions(input, function(k, v) {\n        switch(k) {\n        case \"MPEGT\":\n          settings.integer(k + 'S', v);\n          break;\n        case \"LOCA\":\n          settings.set(k + 'L', parseTimeStamp(v));\n          break;\n        }\n      }, /[^\\d]:/, /,/);\n\n      self.ontimestampmap && self.ontimestampmap({\n        \"MPEGTS\": settings.get(\"MPEGTS\"),\n        \"LOCAL\": settings.get(\"LOCAL\")\n      });\n    }\n\n    // 3.2 WebVTT metadata header syntax\n    function parseHeader(input) {\n      if (input.match(/X-TIMESTAMP-MAP/)) {\n        // This line contains HLS X-TIMESTAMP-MAP metadata\n        parseOptions(input, function(k, v) {\n          switch(k) {\n          case \"X-TIMESTAMP-MAP\":\n            parseTimestampMap(v);\n            break;\n          }\n        }, /=/);\n      } else {\n        parseOptions(input, function (k, v) {\n          switch (k) {\n          case \"Region\":\n            // 3.3 WebVTT region metadata header syntax\n            parseRegion(v);\n            break;\n          }\n        }, /:/);\n      }\n\n    }\n\n    // 5.1 WebVTT file parsing.\n    try {\n      var line;\n      if (self.state === \"INITIAL\") {\n        // We can't start parsing until we have the first line.\n        if (!/\\r\\n|\\n/.test(self.buffer)) {\n          return this;\n        }\n\n        line = collectNextLine();\n\n        var m = line.match(/^WEBVTT([ \\t].*)?$/);\n        if (!m || !m[0]) {\n          throw new ParsingError(ParsingError.Errors.BadSignature);\n        }\n\n        self.state = \"HEADER\";\n      }\n\n      var alreadyCollectedLine = false;\n      while (self.buffer) {\n        // We can't parse a line until we have the full line.\n        if (!/\\r\\n|\\n/.test(self.buffer)) {\n          return this;\n        }\n\n        if (!alreadyCollectedLine) {\n          line = collectNextLine();\n        } else {\n          alreadyCollectedLine = false;\n        }\n\n        switch (self.state) {\n        case \"HEADER\":\n          // 13-18 - Allow a header (metadata) under the WEBVTT line.\n          if (/:/.test(line)) {\n            parseHeader(line);\n          } else if (!line) {\n            // An empty line terminates the header and starts the body (cues).\n            self.state = \"ID\";\n          }\n          continue;\n        case \"NOTE\":\n          // Ignore NOTE blocks.\n          if (!line) {\n            self.state = \"ID\";\n          }\n          continue;\n        case \"ID\":\n          // Check for the start of NOTE blocks.\n          if (/^NOTE($|[ \\t])/.test(line)) {\n            self.state = \"NOTE\";\n            break;\n          }\n          // 19-29 - Allow any number of line terminators, then initialize new cue values.\n          if (!line) {\n            continue;\n          }\n          self.cue = new (self.vttjs.VTTCue || self.window.VTTCue)(0, 0, \"\");\n          // Safari still uses the old middle value and won't accept center\n          try {\n            self.cue.align = \"center\";\n          } catch (e) {\n            self.cue.align = \"middle\";\n          }\n          self.state = \"CUE\";\n          // 30-39 - Check if self line contains an optional identifier or timing data.\n          if (line.indexOf(\"-->\") === -1) {\n            self.cue.id = line;\n            continue;\n          }\n          // Process line as start of a cue.\n          /*falls through*/\n        case \"CUE\":\n          // 40 - Collect cue timings and settings.\n          try {\n            parseCue(line, self.cue, self.regionList);\n          } catch (e) {\n            self.reportOrThrowError(e);\n            // In case of an error ignore rest of the cue.\n            self.cue = null;\n            self.state = \"BADCUE\";\n            continue;\n          }\n          self.state = \"CUETEXT\";\n          continue;\n        case \"CUETEXT\":\n          var hasSubstring = line.indexOf(\"-->\") !== -1;\n          // 34 - If we have an empty line then report the cue.\n          // 35 - If we have the special substring '-->' then report the cue,\n          // but do not collect the line as we need to process the current\n          // one as a new cue.\n          if (!line || hasSubstring && (alreadyCollectedLine = true)) {\n            // We are done parsing self cue.\n            self.oncue && self.oncue(self.cue);\n            self.cue = null;\n            self.state = \"ID\";\n            continue;\n          }\n          if (self.cue.text) {\n            self.cue.text += \"\\n\";\n          }\n          self.cue.text += line.replace(/\\u2028/g, '\\n').replace(/u2029/g, '\\n');\n          continue;\n        case \"BADCUE\": // BADCUE\n          // 54-62 - Collect and discard the remaining cue.\n          if (!line) {\n            self.state = \"ID\";\n          }\n          continue;\n        }\n      }\n    } catch (e) {\n      self.reportOrThrowError(e);\n\n      // If we are currently parsing a cue, report what we have.\n      if (self.state === \"CUETEXT\" && self.cue && self.oncue) {\n        self.oncue(self.cue);\n      }\n      self.cue = null;\n      // Enter BADWEBVTT state if header was not parsed correctly otherwise\n      // another exception occurred so enter BADCUE state.\n      self.state = self.state === \"INITIAL\" ? \"BADWEBVTT\" : \"BADCUE\";\n    }\n    return this;\n  },\n  flush: function () {\n    var self = this;\n    try {\n      // Finish decoding the stream.\n      self.buffer += self.decoder.decode();\n      // Synthesize the end of the current cue or region.\n      if (self.cue || self.state === \"HEADER\") {\n        self.buffer += \"\\n\\n\";\n        self.parse();\n      }\n      // If we've flushed, parsed, and we're still on the INITIAL state then\n      // that means we don't have enough of the stream to parse the first\n      // line.\n      if (self.state === \"INITIAL\") {\n        throw new ParsingError(ParsingError.Errors.BadSignature);\n      }\n    } catch(e) {\n      self.reportOrThrowError(e);\n    }\n    self.onflush && self.onflush();\n    return this;\n  }\n};\n\nmodule.exports = WebVTT;\n"],"mappings":"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K,CAAC,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,EAC9E,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,EAC9E,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,EAC9E,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC,MAAM,EAAE,MAAM,CAAC,EAChE,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE,CAAC,MAAM,EAAE,MAAM,CAAC,EACtE,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE,CAAC,MAAM,EAAE,MAAM,CAAC,EACtE,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE,CAAC,MAAM,EAAE,MAAM,CAAC,EACtE,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAC1E,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAC9E,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAC9E,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAC9E,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAC9E,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAC9E,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAC9E,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAC9E,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAC9E,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAC9E,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAC9E,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAC9E,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE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"},"metadata":{},"sourceType":"script","externalDependencies":[]}